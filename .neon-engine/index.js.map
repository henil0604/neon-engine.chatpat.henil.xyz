{"version":3,"sources":["../app/routes/index.ts","../app/routes/stop.ts","../app/modules/Database.ts","../app/modules/Env.ts","../app/core/ServerFactory.ts","../app/modules/getRouterFactory.ts","../app/index.ts"],"sourcesContent":["import { RouterFactory } from \"@/types/core.js\";\r\n\r\nexport const factory: RouterFactory = (ctx) => {\r\n    return {\r\n        method: 'GET',\r\n        path: '/',\r\n        handler: (request, h) => {\r\n            return 'Hello!';\r\n        }\r\n    }\r\n}","import { RouterFactory } from \"@/types/core.js\";\r\n\r\nexport const factory: RouterFactory = (ctx) => {\r\n    return {\r\n        method: 'GET',\r\n        path: '/stop',\r\n        handler: (request, h) => {\r\n            ctx.factory.stop();\r\n            return 'Stopped!';\r\n        }\r\n    }\r\n}","import { PrismaClient } from \"@prisma/client\";\r\n\r\nconst globalForPrisma = globalThis as unknown as {\r\n    prisma: PrismaClient | undefined;\r\n};\r\n\r\nconst isDev = process.env.NODE_ENV === 'development'\r\n\r\nexport const db =\r\n    globalForPrisma.prisma ??\r\n    new PrismaClient({\r\n        log:\r\n            isDev ? [\"query\", \"error\", \"warn\"] : [\"error\"],\r\n    });\r\n\r\nif (isDev) globalForPrisma.prisma = db;","import dotenv from 'dotenv';\r\nimport { z, ZodSchema } from 'zod';\r\n\r\nexport default class Env {\r\n    private constructor() { }\r\n\r\n    private static parse<T extends ZodSchema<any>>(schema: T, value: string): ReturnType<T['parse']> {\r\n        return schema.parse(value) as ReturnType<T['parse']>;\r\n    }\r\n\r\n    public static get<T extends keyof typeof Env.Schema>(key: T): ReturnType<typeof Env.Schema[T]['parse']> {\r\n        dotenv.config();\r\n        const value = process.env[key];\r\n\r\n        if (!value) {\r\n            throw new Error(`[module:env] ${key} does not exist`);\r\n        }\r\n\r\n        return this.parse(Env.Schema[key], value);\r\n    }\r\n\r\n    public static has(key: keyof typeof Env.Schema): boolean {\r\n        return Boolean(this.get(key));\r\n    }\r\n\r\n    public static Schema = {\r\n        PORT: z.string(),\r\n        USERNAME: z.string(),\r\n        // Add more keys and their corresponding Zod types here\r\n    } as const;\r\n}\r\n","import { db } from \"@/modules/Database.js\";\r\nimport Env from \"@/modules/Env.js\";\r\nimport { RouterFactory, RouterFactoryContext } from \"@/types/core.js\";\r\nimport Hapi from \"@hapi/hapi\";\r\n\r\nexport interface ServerStats {\r\n    is_running: boolean;\r\n}\r\n\r\nexport default class ServerFactory {\r\n    public server: Hapi.Server;\r\n    public stats: ServerStats = {\r\n        is_running: false\r\n    };\r\n\r\n    public constructor() {\r\n        this.server = Hapi.server({\r\n            port: Env.get(\"PORT\")\r\n        })\r\n    }\r\n\r\n    public async start() {\r\n        await this.server.start();\r\n        this.stats.is_running = true;\r\n        this.$onServerStart?.()\r\n        return this;\r\n    }\r\n\r\n    public async stop() {\r\n        await this.server.stop();\r\n        this.stats.is_running = false;\r\n        this.$onServerStop?.();\r\n        return this;\r\n    }\r\n\r\n    public addRoute(routerFactory: RouterFactory) {\r\n        const routerData = routerFactory(this.createRouterFactoryContext())\r\n\r\n        return this.server.route(routerData);\r\n    }\r\n\r\n    private createRouterFactoryContext(): RouterFactoryContext {\r\n        return {\r\n            factory: this,\r\n            db: db\r\n        }\r\n    }\r\n\r\n    public $onServerStart() {\r\n        console.log(`Server is running on port ${this.server.info.port}`);\r\n    }\r\n\r\n    public $onServerStop() {\r\n        console.log(`Server is no more running`);\r\n    }\r\n\r\n\r\n}","const Schema = {\r\n    '/': await import('@/routes/index.js'),\r\n    '/stop': await import('@/routes/stop.js'),\r\n};\r\n\r\n\r\nexport default function getRouterFactory(path: keyof typeof Schema) {\r\n    return Schema[path].factory;\r\n}","import ServerFactory from \"@/core/ServerFactory.js\";\r\nimport getRouterFactory from \"@/modules/getRouterFactory.js\";\r\n\r\nconst Factory = new ServerFactory();\r\n\r\nFactory.start()\r\n\r\nFactory.addRoute(getRouterFactory(\"/\"))\r\nFactory.addRoute(getRouterFactory(\"/stop\"))"],"mappings":"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","names":["factory"]}